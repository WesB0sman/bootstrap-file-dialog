!function(e){"use strict";var a=[".jpg",".jpeg",".png",".gif",".xls",".xlsx",".doc",".docx",".pdf"];e.FileDialog=function(t){function o(){return Array.isArray(r.accept)}function n(e){var a="(."+r.accept.join("|.")+")",t=new RegExp(a),o=t.exec(e.name);return o}var r=e.extend(e.FileDialog.defaults,t),i=e(["<div class='modal fade'>","    <div class='modal-dialog'>","        <div class='modal-content'>","            <div class='modal-header'>","                <button type='button' class='close' data-dismiss='modal'>","                    <span aria-hidden='true'>&times;</span>","                    <span class='sr-only'>",r.cancel_button,"                    </span>","                </button>","                <h4 class='modal-title'>",r.title,"                </h4>","            </div>","            <div class='modal-body'>","                <input class='bfd-input' type='file' />","                <div class='bfd-dropfield'>","                    <div class='bfd-dropfield-inner'>",r.drag_message,"                    </div>","                </div>","                <div class='container-fluid bfd-files'>","                </div>","            </div>","            <div class='modal-footer'>","                <button type='button' class='btn btn-primary bfd-ok'>",r.ok_button,"                </button>","                <button type='button' class='btn btn-default bfd-cancel'","                                data-dismiss='modal'>",r.cancel_button,"                </button>","            </div>","        </div>","    </div>","</div>"].join("")),d=!1,s=e("input:file",i),l=e(".bfd-dropfield",i),c=e(".bfd-dropfield-inner",l);c.css({height:r.dropheight,"padding-top":r.dropheight/2-32}),s.attr({accept:function(){var e=o();return e&&r.accept.length>0?r.accept.join(","):a.join(",")},multiple:function(){return r.multiple===!0?"multiple":!1}}),l.on("click.bfd",function(){s.trigger("click")});var p=[],f=[],u=[],v=[],g=function(a){var t,d,s=new FileReader,l=o(),c=n(a);r.multiple===!0?f.push(s):f[0]=s,s.onloadstart=function(){},s.onerror=function(e){e.target.error.code!==e.target.error.ABORT_ERR&&t.parent().html(["<div class='bg-danger bfd-error-message'>",r.error_message,"</div>"].join("\n"))},s.onprogress=function(e){var a=Math.round(100*e.loaded/e.total)+"%";t.attr("aria-valuenow",e.loaded).css("width",a).text(a)},s.onload=function(e){a.content=e.target.result,r.multiple===!0?p.push(a):p[0]=a,t.removeClass("active")};var g=e(["<div class='col-xs-7 col-sm-6 bfd-info'>","    <span class='glyphicon glyphicon-remove bfd-remove'></span>&nbsp;","    <span class='glyphicon glyphicon-file'></span>&nbsp;"+a.name,"</div>","<div class='col-xs-5 col-sm-6 bfd-progress'>","    <div class='progress'>","        <div class='progress-bar progress-bar-striped active' role='progressbar'","            aria-valuenow='0' aria-valuemin='0' aria-valuemax='"+a.size+"'>","            <span class='sr-only'>0%</span>","        </div>","    </div>","</div>"].join(""));if(t=e(".progress-bar",g),e(".bfd-remove",g).tooltip({container:"body",html:!0,placement:"top",title:r.remove_message}).on("click.bfd",function(){var e=p.indexOf(a);e>=0&&p.pop(e),d.fadeOut();try{s.abort()}catch(t){}}),d=e("<div class='row'></div>"),d.append(g),r.multiple===!0?(u.push(t),v.push(d)):(u[0]=t,void 0!==v[0]&&v[0].detach(),v[0]=d),l&&null!==c)s["readAs"+r.readAs](a),e(".bfd-files",i).append(d),e(".bfd-file-type-error").detach();else{var b="<p></p><p>Error unrecognized file type for file: "+a.name+"</p>",m="<p>The accepted file types are: "+r.accept.join(", ")+"</p>",h=e("<div/>").addClass("bfd-file-type-error").addClass("text-danger").append(b).append(m);e(".bfd-input").after(h)}},b=function(e){Array.prototype.forEach.apply(e,[g])};return s.change(function(e){e=e.originalEvent;var a=e.target.files;b(a);var t=s.clone(!0);s.replaceWith(t),s=t}),l.on("dragenter.bfd",function(){c.addClass("bfd-dragover")}).on("dragover.bfd",function(e){e=e.originalEvent,e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}).on("dragleave.bfd drop.bfd",function(){c.removeClass("bfd-dragover")}).on("drop.bfd",function(e){e=e.originalEvent,e.stopPropagation(),e.preventDefault();var a=e.dataTransfer.files;0===a.length,b(a)}),e(".bfd-ok",i).on("click.bfd",function(){var a=e.Event("files.bs.filedialog");a.files=p,i.trigger(a),d=!0,i.modal("hide")}),i.on("hidden.bs.modal",function(){if(f.forEach(function(e){try{e.abort()}catch(a){}}),!d){var a=e.Event("cancel.bs.filedialog");i.trigger(a)}i.remove()}),e(document.body).append(i),i.modal(),i},e.FileDialog.defaults={accept:a,cancel_button:"Close",drag_message:"Drop files here",dropheight:400,error_message:"An error occured while loading file",multiple:!0,ok_button:"OK",readAs:"DataURL",remove_message:"Remove&nbsp;file",title:"Load file(s)"}}(jQuery);